<!DOCTYPE html>
<!--
  index.html
  Mini README:
  - Purpose: renders the main 3D meeting interface and surrounding UI chrome.
  - Structure:
    1. Page styling and navigation bar
    2. Entry mode menu and on-screen usage instructions
    3. Camera control sidebar with real-time status
    4. A-Frame scene setup with assets, cameras, avatar and spectate marker
       (webcam only on front face; remote avatars mirror this layout with a
       placeholder colour until video streaming is available)
    5. Client scripts for movement and navbar functionality
  - Notes: A-Frame's default WASD controls are disabled on all cameras so that
    movement is handled exclusively by custom code in mingle_client.js.
-->
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mingle Prototype</title>
  <style>
    /* Make the scene occupy the full viewport */
    html, body { width: 100%; height: 100%; margin: 0; font-family: Arial, sans-serif; }
    a-scene { width: 100%; height: 100%; }
    /* Simple navigation bar anchored to the top of the page */
    nav {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 50px;
      background: #333;
      color: #fff;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 10px;
      z-index: 200;
    }
    nav a { color: #fff; text-decoration: none; font-weight: bold; }
    .profile-menu { position: relative; }
    .profile-button {
      width: 40px;
      height: 40px;
      border-radius: 20px;
      cursor: pointer;
    }
    .dropdown {
      position: absolute;
      right: 0;
      top: 50px;
      background: #fff;
      color: #333;
      list-style: none;
      padding: 0;
      margin: 0;
      border: 1px solid #ccc;
      display: none;
      min-width: 180px;
    }
    .dropdown li a {
      display: block;
      padding: 10px 15px;
      color: #333;
    }
    .dropdown li a:hover { background: #f0f0f0; }
    .dropdown.show { display: block; }
    #instructions {
      position: absolute;
      top: 60px;
      left: 10px;
      background: rgba(0,0,0,0.6);
      color: #fff;
      padding: 10px;
      z-index: 100;
    }
    #sidebar {
      position: fixed;
      top: 60px;
      right: 10px;
      width: 220px;
      background: rgba(255,255,255,0.9);
      color: #000;
      padding: 10px;
      border: 1px solid #ccc;
      z-index: 150;
      font-size: 14px;
    }
    #status {
      margin-top: 10px;
      font-size: 12px;
      color: #333;
    }
    /* Simple start menu allowing users to choose their entry mode */
    #modeMenu {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(255,255,255,0.95);
      border: 1px solid #ccc;
      padding: 20px;
      z-index: 250;
      text-align: center;
    }
    #modeMenu.hidden { display: none; }
    #modeMenu button {
      margin: 0 5px;
      padding: 10px 15px;
      cursor: pointer;
    }
  </style>
  <!--
    Load A-Frame and supporting libraries *before* the scene so that all
    custom elements are registered when the HTML is parsed. The configuration
    script exposes whether the server was launched in debug mode.
  -->
  <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/socket.io-client@4.7.2/dist/socket.io.min.js"></script>
  <script src="/config.js"></script>
</head>
<body>
  <nav>
    <div><a href="/index.html">Mingle</a></div>
    <div class="profile-menu">
      <img src="https://via.placeholder.com/40" alt="Profile" id="profileButton" class="profile-button" />
      <ul id="profileDropdown" class="dropdown">
        <li><a href="manage_profiles.html">Manage Profiles</a></li>
        <li><a href="learning_zone.html">Learning Zone</a></li>
        <li><a href="my_details.html">My Details</a></li>
        <li><a href="subscription_details.html">Subscription Details</a></li>
        <li><a href="manage_users.html">Manage Users</a></li>
        <li><a href="#" id="signOut">Sign out</a></li>
      </ul>
    </div>
  </nav>
  <!-- Initial mode selection menu displayed before entering the world -->
  <div id="modeMenu">
    <p>Select how to enter the world:</p>
    <button data-mode="fpv">FPV mode</button>
    <button data-mode="spectator">Spectator mode</button>
    <button data-mode="lakitu">Lakitu mode</button>
  </div>
  <div id="instructions">
    <p>Choose a mode, then use WASD to move and mouse to look. Click to lock pointer.</p>
    <p>Use the profile button in the top-right to access account options.</p>
  </div>

  <aside id="sidebar">
    <label><input type="checkbox" id="spectateToggle"> Spectate mode</label><br />
    <div>
      <p>Viewpoint:</p>
      <label><input type="radio" name="viewpoint" value="high" checked> High corner</label><br />
      <label><input type="radio" name="viewpoint" value="ground"> Ground corner</label><br />
      <label><input type="radio" name="viewpoint" value="top"> Top-down</label>
    </div>
    <div id="status"></div>
  </aside>

  <!-- Main A-Frame scene. Removing 'embedded' allows full-screen rendering -->
  <!-- Disable the default loading screen so the environment appears even if the
       webcam stream takes a while to initialise. -->
  <a-scene loading-screen="enabled: false">
    <a-assets>
      <!--
        Include the video element used for the local webcam feed. The `muted`
        attribute ensures browsers allow autoplay which lets A-Frame finish
        loading instead of leaving the user on the default blue loading screen.
      -->
      <video id="localVideo" autoplay playsinline muted></video>
    </a-assets>

    <!-- Simple floor and lighting -->
    <a-plane rotation="-90 0 0" width="20" height="20" color="#7BC8A4"></a-plane>
    <a-entity light="type: ambient; intensity: 0.5"></a-entity>
    <a-entity light="type: directional; intensity: 0.8" position="0 1 1"></a-entity>

    <!-- Player entity that holds the camera and avatar. Movement is handled by a
         custom controller in mingle_client.js so we omit the built-in
         `wasd-controls`. The avatar starts hidden so it does not obstruct the
         first-person view but becomes visible in spectate mode. -->
    <a-entity id="player" position="0 1.6 0">
      <!-- The avatar consists of a front-facing plane that displays the webcam
           feed and a rear backing plane so the video only appears on the face
           pointing in the camera direction. Remote participants are rendered
           on every client by duplicating this front/back layout; their video
           plane currently uses a placeholder colour until streaming is wired
           up. The camera itself sits at the origin, directly behind the avatar's
           front face. -->
      <a-camera id="playerCamera" position="0 0 0" look-controls="pointerLockEnabled: true" wasd-controls="enabled: false"></a-camera>
      <!-- Position the avatar directly in front of the player camera. The video
           plane is rotated to face the same direction as the player so all
           clients view the webcam on the avatar's front rather than the back. -->
      <a-entity id="avatar" position="0 0 0" visible="false">
        <a-plane id="avatarFront" width="1" height="1" material="src:#localVideo" position="0 0 -0.05" rotation="0 180 0"></a-plane>
        <a-plane id="avatarBack" width="1" height="1" color="#FFFFFF" position="0 0 0.05"></a-plane>
      </a-entity>
    </a-entity>

    <!-- Spectator camera that remains fixed at predefined viewpoints. Mouse
         movement does not influence its orientation. A small marker indicates
         its position when spectating. -->
    <a-camera id="spectateCam" position="10 10 10" rotation="-35 -45 0" fov="80"
              visible="false" wasd-controls="enabled: false"
              look-controls="pointerLockEnabled: true"></a-camera>
    <a-box id="spectateMarker" width="0.5" height="0.5" depth="0.5" visible="false"></a-box>
  </a-scene>

  <!-- Client logic is loaded last once the DOM and libraries are ready -->
  <script src="js/mingle_client.js"></script>
  <script src="js/mingle_navbar.js"></script>
</body>
</html>
