<!DOCTYPE html>
<!--
  world_admin.html
  Mini README:
  - Purpose: provide a simple admin interface to view and update world settings
    and upload avatar assets.
  - Structure:
    1. Navbar reused across Mingle pages
    2. Instructional form for admin token and world configuration values
    3. Fields for world design (geometry and colour)
    4. Avatar asset management: body and TV tables with metadata, upload/delete controls
       plus a Three.js preview to align the TV and webcam canvas
    5. Client-side script to load and save settings via the secure API
    6. Debug log area (#debugLog) surfaces script errors and typical causes
  - Notes:
    - requires the server to be started with ADMIN_TOKEN for access
    - loads Three.js and GLTFLoader from local `js/vendor` paths with error
      handlers to aid debugging; update these with the curl commands listed in
      the project README when a newer release is needed
-->
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>World Administration - Mingle</title>
  <style>
    html, body { margin:0; font-family: Arial, sans-serif; }
    nav {
      position: fixed; top:0; left:0; right:0; height:50px;
      background:#333; color:#fff; display:flex;
      justify-content: space-between; align-items:center;
      padding:0 10px; z-index:100;
    }
    nav a { color:#fff; text-decoration:none; font-weight:bold; }
    .profile-menu { position:relative; }
    .profile-button { width:40px; height:40px; border-radius:20px; cursor:pointer; }
    .dropdown { position:absolute; right:0; top:50px; background:#fff; color:#333; list-style:none; padding:0; margin:0; border:1px solid #ccc; display:none; min-width:180px; }
    .dropdown li a { display:block; padding:10px 15px; color:#333; }
    .dropdown li a:hover { background:#f0f0f0; }
    .dropdown.show { display:block; }
    main { padding:70px 10px; }
    label { display:block; margin-top:10px; }
    input, textarea { width:100%; padding:8px; margin-top:5px; box-sizing:border-box; }
    button { margin-top:15px; padding:10px 15px; }
    table { width:100%; border-collapse:collapse; margin-top:10px; }
    th, td { border:1px solid #ccc; padding:5px; text-align:left; }
  </style>
  <script src="/config.js"></script>
</head>
<body>
  <nav>
    <div><a href="/index.html">Mingle</a></div>
    <div class="profile-menu">
      <img src="https://via.placeholder.com/40" alt="Profile" id="profileButton" class="profile-button" />
      <ul id="profileDropdown" class="dropdown">
        <li><a href="manage_profiles.html">Manage Profiles</a></li>
        <li><a href="learning_zone.html">Learning Zone</a></li>
        <li><a href="my_details.html">My Details</a></li>
        <li><a href="subscription_details.html">Subscription Details</a></li>
        <li><a href="manage_users.html">Manage Users</a></li>
        <li><a href="#" id="signOut">Sign out</a></li>
      </ul>
    </div>
  </nav>
  <main>
    <h1>World Configuration</h1>
    <p>Enter the admin token and adjust the values below to configure the shared world.</p>
    <label for="token">Admin Token</label>
    <input type="password" id="token" placeholder="Required" />
    <label for="worldName">World Name</label>
    <input type="text" id="worldName" placeholder="Mingle World" />
    <label for="maxParticipants">Max Participants</label>
    <input type="number" id="maxParticipants" min="1" value="20" />
    <label for="welcomeMessage">Welcome Message</label>
    <textarea id="welcomeMessage" rows="3" placeholder="Welcome to Mingle"></textarea>
    <label for="worldGeometry">World Geometry</label>
    <select id="worldGeometry">
      <option value="plane">Plane</option>
      <option value="cube">Cube</option>
      <option value="sphere">Sphere</option>
    </select>
    <label for="worldColor">World Colour</label>
    <input type="color" id="worldColor" value="#00aaff" />
    <button id="loadBtn" type="button">Load Current Config</button>
    <button id="saveBtn" type="button">Save Config</button>

    <h2>Avatar Assets</h2>
    <p>Select models, preview placement and adjust the webcam canvas. Admin token is required for uploads or deletions.</p>
    <div id="avatarAssets" style="display:flex; gap:20px;">
      <div id="bodyColumn" style="flex:1;">
        <h3>Bodies</h3>
        <table>
          <thead>
            <tr><th>Preview</th><th>Info</th><th>Select</th><th>Delete</th></tr>
          </thead>
          <tbody id="bodyTableBody"></tbody>
        </table>
        <div style="margin-top:10px;">
          <input type="file" id="bodyFile" accept=".glb" />
          <button id="uploadBodyBtn" type="button">Upload New Body</button>
        </div>
      </div>
      <div id="tvColumn" style="flex:1;">
        <h3>TVs</h3>
        <table>
          <thead>
            <tr><th>Preview</th><th>Info</th><th>Select</th><th>Delete</th></tr>
          </thead>
          <tbody id="tvTableBody"></tbody>
        </table>
        <div style="margin-top:10px;">
          <input type="file" id="tvFile" accept=".glb" />
          <button id="uploadTVBtn" type="button">Upload New TV</button>
        </div>
      </div>
      <div id="previewColumn" style="flex:1;">
        <h3>Preview & Placement</h3>
        <canvas id="previewCanvas" width="400" height="400" style="border:1px solid #ccc;"></canvas>
        <div id="sliderColumns" style="display:flex; gap:10px; margin-top:10px;">
          <div>
            <label>TV X <input type="range" id="tvPosX" min="-2" max="2" step="0.01" value="0"></label>
            <label>TV Y <input type="range" id="tvPosY" min="-2" max="2" step="0.01" value="1"></label>
            <label>TV Z <input type="range" id="tvPosZ" min="-2" max="2" step="0.01" value="0"></label>
            <label>TV Scale <input type="range" id="tvScaleRange" min="0.1" max="5" step="0.1" value="1"></label>
          </div>
          <div>
            <label>Cam X <input type="range" id="camPosX" min="-1" max="1" step="0.01" value="0"></label>
            <label>Cam Y <input type="range" id="camPosY" min="-1" max="1" step="0.01" value="0"></label>
            <label>Cam Z <input type="range" id="camPosZ" min="-1" max="1" step="0.01" value="-0.25"></label>
            <label>Cam Scale <input type="range" id="camScaleRange" min="0.1" max="5" step="0.1" value="1"></label>
          </div>
        </div>
    <button id="savePlacementBtn" type="button" style="margin-top:10px;">Save and Update User Avatars</button>
      </div>
    </div>
    <h2>Debug Log</h2>
      <div id="debugLog" style="white-space: pre-wrap; background:#f9f9f9; border:1px solid #ccc; padding:10px; margin-top:20px;">No errors logged.</div>
      </main>
    <!-- model-viewer is an ES module; load it accordingly so custom element renders previews -->
    <script type="module" src="https://cdn.jsdelivr.net/npm/@google/model-viewer/dist/model-viewer.min.js"></script>
    <script>
      // Handle vendor script load errors by logging and notifying the user.
      function handleScriptError(lib) {
        console.error(`${lib} failed to load. Verify network access or local file paths.`);
        alert(`${lib} failed to load. Please check your internet connection or local file paths.`);
      }
    </script>
    <script type="module" src="js/vendor/three.module.js" onerror="handleScriptError('Three.js')"></script>
    <script type="module" src="js/vendor/GLTFLoader.js" onerror="handleScriptError('GLTFLoader')"></script>
    <script src="js/mingle_navbar.js"></script>
    <script type="module" src="js/world_admin.module.js"></script>
  </body>
</html>
